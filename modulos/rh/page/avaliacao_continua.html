<div class="dashboard-section">
  <div class="section-header">
    <h2>Avaliação Contínua e Monitoramento</h2>
    <p class="text-muted">
      Acompanhe o desempenho, conformidade com a trilha e feedbacks dos voluntários e pacientes.
    </p>
  </div>

  <div class="tabs-container status-tabs" id="tabs-avaliacao">
    <button class="tab-link active" data-tab="monitoramento">
      <i class="fas fa-eye me-2"></i> Monitoramento da Trilha
    </button>
    <button class="tab-link" data-tab="avaliacao-rh">
      <i class="fas fa-user-check me-2"></i> Avaliação RH / 360º
    </button>
    <button class="tab-link" data-tab="feedback-profissional">
      <i class="fas fa-comment-alt me-2"></i> Feedback do Voluntário
    </button>
    <button class="tab-link" data-tab="pesquisa-paciente">
      <i class="fas fa-smile me-2"></i> Pesquisa de Satisfação (Pacientes)
    </button>
  </div>

  <div id="tab-monitoramento" class="tab-content active">
    <div class="description-box">
      <p>
        Verifique se os voluntários estão preenchendo corretamente as presenças e as fichas de evolução na Trilha do Paciente (últimos 30 dias).
      </p>
    </div>
    
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Profissional</th>
            <th>Pacientes Ativos</th>
            <th>Sessões (30d)</th>
            <th>Presenças Preenchidas</th>
            <th>Evoluções Preenchidas</th>
            <th>Status Conformidade</th>
            <th>Ação</th>
          </tr>
        </thead>
        <tbody id="tbody-monitoramento">
          <tr>
            <td colspan="7" class="text-center"><div class="loading-spinner"></div></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div id="tab-avaliacao-rh" class="tab-content" style="display: none;">
    <div class="row">
      <div class="col-md-4">
        <div class="card p-3">
          <h4>Selecionar Profissional</h4>
          <div class="form-group">
            <input type="text" id="busca-profissional-360" class="form-control" placeholder="Buscar por nome...">
          </div>
          <ul id="lista-profissionais-360" class="list-group mt-3" style="max-height: 400px; overflow-y: auto;">
            <li class="list-group-item text-muted">Carregando...</li>
          </ul>
        </div>
      </div>
      <div class="col-md-8">
        <div id="form-container-360" class="card p-4" style="display: none;">
          <h4 class="mb-3">Avaliação de Desempenho: <span id="nome-profissional-360" class="text-primary"></span></h4>
          <form id="form-avaliacao-360">
            <input type="hidden" id="uid-profissional-360">
            
            <div class="form-group mb-3">
              <label class="form-label fw-bold">Assiduidade e Pontualidade</label>
              <select class="form-control" id="nota-assiduidade" required>
                <option value="">Selecione...</option>
                <option value="5">Excelente - Sempre pontual e presente</option>
                <option value="4">Bom - Raramente falta ou atrasa</option>
                <option value="3">Regular - Algumas faltas/atrasos justificados</option>
                <option value="2">Ruim - Faltas/atrasos frequentes</option>
                <option value="1">Crítico - Não cumpre horários</option>
              </select>
            </div>

            <div class="form-group mb-3">
              <label class="form-label fw-bold">Adesão aos Processos (Trilha/Sistemas)</label>
              <select class="form-control" id="nota-processos" required>
                <option value="">Selecione...</option>
                <option value="5">Excelente - Preenche tudo corretamente e no prazo</option>
                <option value="4">Bom - Preenche a maioria, raros esquecimentos</option>
                <option value="3">Regular - Precisa de cobrança ocasional</option>
                <option value="2">Ruim - Frequentemente esquece registros</option>
                <option value="1">Crítico - Não utiliza os sistemas</option>
              </select>
            </div>

            <div class="form-group mb-3">
              <label class="form-label fw-bold">Relacionamento Interpessoal e Comunicação</label>
              <select class="form-control" id="nota-relacionamento" required>
                <option value="">Selecione...</option>
                <option value="5">Excelente</option>
                <option value="4">Bom</option>
                <option value="3">Regular</option>
                <option value="2">Ruim</option>
                <option value="1">Crítico</option>
              </select>
            </div>

            <div class="form-group mb-3">
              <label class="form-label fw-bold">Feedback Qualitativo (Pontos Fortes e a Desenvolver)</label>
              <textarea class="form-control" id="texto-feedback" rows="5" required></textarea>
            </div>

            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="enviar-email-feedback">
              <label class="form-check-label" for="enviar-email-feedback">
                Enviar cópia deste feedback por e-mail ao voluntário
              </label>
            </div>

            <button type="submit" class="action-button primary">Salvar Avaliação</button>
          </form>
        </div>
        <div id="placeholder-360" class="alert alert-info mt-3">
          Selecione um profissional na lista ao lado para iniciar a avaliação.
        </div>
      </div>
    </div>
  </div>

  <div id="tab-feedback-profissional" class="tab-content" style="display: none;">
    <div class="row mb-4">
      <div class="col-md-8">
        <div class="description-box">
          <p>Resultados da pesquisa de satisfação interna (eNPS) respondida pelos voluntários.</p>
        </div>
      </div>
      <div class="col-md-4 text-end">
        <button class="action-button primary" id="btn-copiar-link-feedback">
          <i class="fas fa-link me-2"></i> Copiar Link do Formulário
        </button>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card p-3 text-center border-primary">
          <h2 class="display-4 fw-bold text-primary" id="metric-nps">-</h2>
          <p class="text-muted mb-0">NPS (Net Promoter Score)</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card p-3 text-center">
          <h3 id="metric-promotores" class="text-success">-</h3>
          <p class="text-muted mb-0">Promotores (9-10)</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card p-3 text-center">
          <h3 id="metric-neutros" class="text-warning">-</h3>
          <p class="text-muted mb-0">Neutros (7-8)</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card p-3 text-center">
          <h3 id="metric-detratores" class="text-danger">-</h3>
          <p class="text-muted mb-0">Detratores (0-6)</p>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header bg-light">
        <h5 class="mb-0"><i class="fas fa-list me-2"></i> Feedbacks Recentes</h5>
      </div>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Data</th>
              <th>Voluntário</th>
              <th>Nota (0-10)</th>
              <th>Suporte</th>
              <th>Processos</th>
              <th>Sugestão/Comentário</th>
            </tr>
          </thead>
          <tbody id="tbody-feedbacks">
            <tr><td colspan="6" class="text-center">Carregando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

<div id="tab-pesquisa-paciente" class="tab-content" style="display: none;">
    <div class="row">
      <div class="col-md-4">
        <div class="card p-3 h-100">
          <h4><i class="fas fa-search me-2"></i> Seleção de Pacientes</h4>
          <p class="text-muted small">Selecione o profissional e o status para listar os pacientes.</p>
          
          <div class="form-group mb-3">
            <label class="fw-bold">1. Profissional:</label>
            <select id="nps-select-profissional" class="form-control">
              <option value="">Carregando...</option>
            </select>
          </div>

          <div class="form-group mb-3">
            <label class="fw-bold">2. Status do Paciente:</label>
            <select id="nps-select-status" class="form-control" disabled>
              <option value="ativo">Ativos (Em Atendimento)</option>
              <option value="inativo">Inativos (Alta/Desistência)</option>
            </select>
          </div>

          <button id="nps-btn-buscar" class="action-button primary w-100" disabled>
            <i class="fas fa-list"></i> Listar Pacientes
          </button>
        </div>
      </div>

      <div class="col-md-8">
        <div class="card p-0">
          <div class="card-header bg-light p-3 border-bottom">
            <h5 class="mb-0 m-0">Lista de Pacientes para Envio</h5>
          </div>
          <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
            <table class="table table-hover mb-0" id="tabela-nps-pacientes">
              <thead style="position: sticky; top: 0; background: white; z-index: 1;">
                <tr>
                  <th>Paciente</th>
                  <th>Telefone</th>
                  <th>Status</th>
                  <th class="text-end">Ação</th>
                </tr>
              </thead>
              <tbody id="tbody-nps-pacientes">
                <tr>
                  <td colspan="4" class="text-center py-5 text-muted">
                    Selecione um profissional e clique em "Listar Pacientes"
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script type="module" src="../js/avaliacao_continua.js"></script>