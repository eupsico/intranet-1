<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√µes do Sistema</title>
    <link rel="stylesheet" href="../css/configuracoes.css"> 
</head>
<body>
    <div class="config-container">
        <h2 class="title">Configura√ß√µes Gerais do Sistema</h2>
        <p class="subtitle">Ajuste os par√¢metros, textos e regras de neg√≥cio da plataforma.</p>

        <div class="tabs">
            <button class="tab-link active" onclick="openTab(event, 'financeiro')">Financeiro</button>
            <button class="tab-link" onclick="openTab(event, 'agendamentos')">Agendamentos</button>
            <button class="tab-link" onclick="openTab(event, 'listas')">Listas</button>
            <button class="tab-link" onclick="openTab(event, 'textos')">Modelos de Mensagem</button>
            <button class="tab-link" onclick="openTab(event, 'feedback')">Feedback</button>
            <button class="tab-link" onclick="openTab(event, 'manutencao')" style="color: #d35400;">Manuten√ß√£o</button>
        </div>

        <form id="config-form">
            
            <div id="financeiro" class="tab-content active">
                <h3>Par√¢metros Financeiros</h3>
                <div class="form-group">
                    <label for="percentualSupervisao">Percentual da Supervis√£o (%)</label>
                    <input type="number" id="percentualSupervisao" name="financeiro.percentualSupervisao" placeholder="Ex: 20">
                </div>
                <div class="form-group">
                    <label for="diaLimiteComprovantes">Dia Limite para Envio de Comprovantes</label>
                    <input type="number" id="diaLimiteComprovantes" name="financeiro.diaLimiteComprovantes" placeholder="Ex: 10">
                </div>
                <hr>
                <h4>Faixas de Contribui√ß√£o (Servi√ßo Social)</h4>
                <p class="description">Defina as faixas de sal√°rio m√≠nimo e os percentuais de contribui√ß√£o correspondentes.</p>
                <div class="form-group">
                    <label for="percentualAdicionalFamilia">Percentual Adicional (Fam√≠lia %)</label>
                    <input type="number" id="percentualAdicionalFamilia" name="financeiro.percentualAdicionalFamilia" placeholder="Ex: 40">
                    <p class="description">Percentual a ser acrescido no valor de contribui√ß√£o para atendimentos familiares.</p>
                </div>
                <div class="faixas-table-container">
                    <table class="faixas-table">
                        <thead>
                            <tr>
                                <th>Faixa (At√© X sal√°rios m√≠nimos)</th>
                                <th>Percentual (%)</th>
                                <th>A√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="faixas-contribuicao-tbody"></tbody>
                    </table>
                    <button type="button" id="btn-adicionar-faixa" class="btn-adicionar-faixa">+ Adicionar Faixa</button>
                </div>
            </div>

            <div id="agendamentos" class="tab-content">
                <h4>Regras de Agendamento (Triagem)</h4>
                <p class="description">Par√¢metros que afetam a busca e agendamento de hor√°rios para a triagem inicial com o servi√ßo social.</p>
                <div class="form-group">
                    <label for="minimoHorasAntecedencia">M√≠nimo de Horas de Anteced√™ncia para Agendamento (Triagem)</label>
                    <input type="number" id="minimoHorasAntecedencia" name="agendamentos.minimoHorasAntecedencia" placeholder="Ex: 24">
                </div>
                <div class="form-group">
                    <label for="quantidadeDiasBusca">Quantidade de Dias para Busca de Hor√°rios (Triagem)</label>
                    <input type="number" id="quantidadeDiasBusca" name="agendamentos.quantidadeDiasBusca" placeholder="Ex: 90">
                </div>
                <hr>
                <h4>Regras de Agendamento (Supervis√£o)</h4>
                <p class="description">Par√¢metros que afetam a busca e agendamento de hor√°rios de supervis√£o pelos volunt√°rios.</p>
                <div class="form-group">
                    <label for="minimoAgendaSupervisao">M√≠nimo de Horas de Anteced√™ncia para Agendamento (Supervis√£o)</label>
                    <input type="number" id="minimoAgendaSupervisao" name="agendamentos.minimoAgendaSupervisao" placeholder="Ex: 48">
                </div>
                <div class="form-group">
                    <label for="quantidadeDiasSupervisao">Quantidade de Dias para Busca de Hor√°rios (Supervis√£o)</label>
                    <input type="number" id="quantidadeDiasSupervisao" name="agendamentos.quantidadeDiasSupervisao" placeholder="Ex: 60">
                </div>
                <hr>
                <h4>Prazos da Trilha do Paciente (em dias √∫teis)</h4>
                <div class="form-group">
                    <label for="prazoContatoTriagem">Prazo para Contato da Triagem</label>
                    <input type="number" id="prazoContatoTriagem" name="prazos.contatoTriagem" placeholder="Ex: 30">
                </div>
                <div class="form-group">
                    <label for="prazoInicioTerapia">Prazo para In√≠cio da Terapia</label>
                    <input type="number" id="prazoInicioTerapia" name="prazos.inicioTerapia" placeholder="Ex: 20">
                </div>
            </div>

            <div id="listas" class="tab-content">
                <h3>Listas Edit√°veis</h3>
                <div class="form-group">
                    <label for="departamentos">Lista de Departamentos (um por linha)</label>
                    <textarea id="departamentos" name="listas.departamentos" rows="5" placeholder="Recursos Humanos&#10;Financeiro&#10;Marketing"></textarea>
                </div>
                <hr>
                <div class="form-group">
                    <label for="salasPresenciais">Nomes das Salas Presenciais (um por linha)</label>
                    <textarea id="salasPresenciais" name="listas.salasPresenciais" rows="5" placeholder="Sala Leila Tardivo&#10;Sala Freud&#10;Sala Winnicott"></textarea>
                </div>
                <div class="form-group">
                    <label for="profissoes">Lista de Profiss√µes (uma por linha)</label>
                    <textarea id="profissoes" name="listas.profissoes" rows="5" placeholder="Psic√≥logo(a)&#10;Assistente Social&#10;M√©dico(a)"></textarea>
                </div>
                <div class="form-group">
                    <label for="conselhos">Lista de Conselhos Profissionais (um por linha)</label>
                    <textarea id="conselhos" name="listas.conselhos" rows="5" placeholder="CRP&#10;CRM&#10;CRESS"></textarea>
                </div>
                <hr>
                <div class="form-group">
                    <label for="parcerias">Lista de Parcerias (uma por linha)</label>
                    <textarea id="parcerias" name="listas.parcerias" rows="5" placeholder="Parceiro A&#10;Parceiro B&#10;Cl√≠nica X"></textarea>
                    <p class="description">Op√ß√µes que aparecer√£o quando o paciente estiver na trilha 'Pacientes Parcerias'.</p>
                </div>
                <div class="form-group">
                    <label for="grupos">Lista de Grupos Terap√™uticos (um por linha)</label>
                    <textarea id="grupos" name="listas.grupos" rows="5" placeholder="Grupo de Ansiedade&#10;Grupo de Luto"></textarea>
                    <p class="description">Op√ß√µes para futuros encaminhamentos de grupo.</p>
                </div>
            </div>
            
            <div id="textos" class="tab-content">
                <h3>Modelos de Mensagem</h3>
                <p class="description">Use vari√°veis como `{saudacao}`, `{p}`, `{d}`, `{t}`, etc. para personalizar as mensagens.</p>
                <hr>
                <h4>Mensagens Gerais e de Contrato</h4>
                <div class="form-group">
                    <label for="msgCobrancaVoluntario">Mensagem de Cobran√ßa (Volunt√°rio)</label>
                    <textarea id="msgCobrancaVoluntario" name="textos.cobrancaVoluntario" rows="6"></textarea>
                </div>
                <div class="form-group">
                    <label for="msgEnvioContrato">Mensagem de Envio do Contrato</label>
                    <textarea id="msgEnvioContrato" name="textos.envioContrato" rows="6"></textarea>
                </div>
                <hr>
                <h4>Mensagens de Boas-Vindas e Agendamento</h4>
                <div class="form-group">
                    <label for="msgBoasVindas">Mensagem de Boas-Vindas (Sess√£o Agendada)</label>
                    <textarea id="msgBoasVindas" name="textos.boasVindas" rows="6"></textarea>
                </div>
                <div class="form-group">
                    <label for="msgBoasVindasPlantao">Mensagem de Boas-Vindas (Plant√£o Psicol√≥gico)</label>
                    <textarea id="msgBoasVindasPlantao" name="textos.boasVindasPlantao" rows="6"></textarea>
                </div>
                <div class="form-group">
                    <label for="msgAgendarHorario">Mensagem para Agendar (Oferecer Hor√°rio)</label>
                    <textarea id="msgAgendarHorario" name="textos.agendarHorario" rows="6"></textarea>
                </div>
                <div class="form-group">
                    <label for="msgPrimeiroPagamento">Mensagem de Primeiro Pagamento</label>
                    <textarea id="msgPrimeiroPagamento" name="textos.primeiroPagamento" rows="6"></textarea>
                </div>
            </div>

            <div id="feedback" class="tab-content">
                <h3>Modelo de Perguntas para Feedback</h3>
                <p class="description">Defina as perguntas que aparecer√£o no formul√°rio de feedback das reuni√µes t√©cnicas.</p>
                <div class="faixas-table-container">
                    <table class="faixas-table">
                        <thead>
                            <tr>
                                <th>ID (sem espa√ßos/acentos)</th>
                                <th>Texto da Pergunta</th>
                                <th>Tipo (select ou textarea)</th>
                                <th>Op√ß√µes (separadas por v√≠rgula)</th>
                                <th>A√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="perguntas-feedback-tbody"></tbody>
                    </table>
                    <button type="button" id="btn-adicionar-pergunta" class="btn-adicionar-faixa">+ Adicionar Pergunta</button>
                </div>
            </div>

            <div id="manutencao" class="tab-content">
                <h3>Manuten√ß√£o de Dados</h3>
                <p class="description">Ferramentas para corre√ß√£o e atualiza√ß√£o em massa de dados no banco.</p>
                <hr>
                <div class="form-group">
                    <label>Corrigir IDs em Atendimentos PB e Parcerias</label>
                    <p class="description">Esta ferramenta verifica todos os pacientes na trilha. Se encontrar um item em 'atendimentosPB' onde o <strong>profissionalId</strong> estiver vazio, tentar√° buscar o ID correto na cole√ß√£o de Usu√°rios usando o Nome do Profissional.</p>
                    <button type="button" id="btn-corrigir-ids-pb" class="btn-primary" style="background-color: #d35400;">
                        üîÑ Executar Corre√ß√£o de IDs
                    </button>
                    <div id="log-manutencao" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border: 1px solid #ddd; max-height: 200px; overflow-y: auto; font-family: monospace; display: none;"></div>
                </div>
            </div>

        </form>
        
        <div class="actions">
            <button id="save-button" class="btn-primary">Salvar Altera√ß√µes</button>
            <div id="loading-spinner" class="spinner" style="display: none;"></div>
            <div id="save-feedback"></div>
        </div>
    </div>
</body>
</html>