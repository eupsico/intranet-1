<div class="container-fluid" id="meus-pacientes-view">
    <div class="view-header">
        <h2>Meus Pacientes</h2>
        <p class="description-box">Abaixo estão listados seus pacientes em atendimento. Clique em um paciente para ver os detalhes e ações disponíveis.</p>
    </div>

    <div id="pacientes-accordion-container" class="accordion-container">
    </div>

    <div id="empty-state-pacientes" style="display:none;">
        <p>Nenhum paciente encontrado.</p>
    </div>
</div>

<div id="solicitar-sessoes-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large">
        <div class="modal-body">
            <h2 class="modal-title-text" style="margin-bottom: 20px;">Solicitar Novas Sessões</h2>
            <form id="solicitar-sessoes-form">
                <input type="hidden" id="solicitar-paciente-id">
                <input type="hidden" id="solicitar-atendimento-id">
                
                <fieldset>
                    <legend>Dados do Agendamento</legend>
                    <div class="form-row cols-2">
                        <div class="form-group">
                            <label>Nome do Profissional</label>
                            <input type="text" id="solicitar-profissional-nome" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label>Nome do Paciente</label>
                            <input type="text" id="solicitar-paciente-nome" class="form-control" readonly>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Detalhes da Nova Sessão</legend>
                    <div class="form-row cols-3">
                        <div class="form-group">
                            <label for="solicitar-dia-semana">Dia da Sessão</label>
                            <select id="solicitar-dia-semana" class="form-control" required>
                                <option value="segunda">Segunda-feira</option>
                                <option value="terca">Terça-feira</option>
                                <option value="quarta">Quarta-feira</option>
                                <option value="quinta">Quinta-feira</option>
                                <option value="sexta">Sexta-feira</option>
                                <option value="sabado">Sábado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="solicitar-horario">Horário</label>
                            <select id="solicitar-horario" class="form-control" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="solicitar-tipo-atendimento">Tipo de Atendimento</label>
                            <select id="solicitar-tipo-atendimento" class="form-control" required>
                                <option value="online">Online</option>
                                <option value="presencial">Presencial</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row cols-2">
                        <div class="form-group">
                            <label for="solicitar-data-inicio">Iniciar sessões a partir de:</label>
                            <input type="date" id="solicitar-data-inicio" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="solicitar-sala">Sala de Atendimento</label>
                            <select id="solicitar-sala" class="form-control" required>
                                <option value="Online">Online</option>
                            </select>
                        </div>
                    </div>
                </fieldset>
                <div id="validacao-grade-feedback" class="info-note" style="display: none;"></div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
            <button type="button" class="action-button" id="btn-confirmar-solicitacao">Enviar Solicitação</button>
        </div>
    </div>
</div>

<div id="encerramento-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="encerramento-modal-title">Encerrar Plantão</h3>
            <span class="close-button">&times;</span>
        </div>
        <div class="modal-body">
            <form id="encerramento-form">
                <input type="hidden" id="paciente-id-modal">
                <div class="form-group">
                    <label>Encaminhamento:</label>
                    <div id="encerramento-encaminhamento" class="checkbox-group"><label><input type="checkbox" name="encaminhamento" value="Alta"> Alta</label><label><input type="checkbox" name="encaminhamento" value="Desistência"> Desistência</label><label><input type="checkbox" name="encaminhamento" value="Atendimento Psicológico"> Atendimento Psicológico</label><label><input type="checkbox" name="encaminhamento" value="Atendimento Psicopedagógico"> Atendimento Psicopedagógico</label><label><input type="checkbox" name="encaminhamento" value="Atendimento com musicoterapeuta"> Atendimento com musicoterapeuta</label><label><input type="checkbox" name="encaminhamento" value="RAPS"> RAPS</label><label><input type="checkbox" name="encaminhamento" value="Grupo Questões de peso"> Grupo Questões de peso</label><label class="disabled"><input type="checkbox" name="encaminhamento" value="Grupo papo de adolescente" disabled> Grupo papo de adolescente (Inativo)</label><label class="disabled"><input type="checkbox" name="encaminhamento" value="Grupo de apoio à família" disabled> Grupo de apoio à família (Inativo)</label><label><input type="checkbox" name="encaminhamento" value="Grupo Funcional"> Grupo Funcional</label><label><input type="checkbox" name="encaminhamento" value="Grupo Envelhecimento Ativo"> Grupo Envelhecimento Ativo</label><label class="disabled"><input type="checkbox" name="encaminhamento" value="Grupo TransVivências" disabled> Grupo TransVivências (Inativo)</label><label><input type="checkbox" name="encaminhamento" value="Grupo Reexista"> Grupo Reexista</label></div>
                </div>
                <div class="form-group"><label for="data-encerramento">Data de encerramento/alta/desistência:</label><input type="date" id="data-encerramento" required></div>
                <div class="form-group"><label for="quantidade-sessoes">Quantidade de sessões do plantão:</label><input type="number" id="quantidade-sessoes" required></div>
                <div class="form-group"><label for="pagamento-contribuicao">O paciente efetuou o pagamento da contribuição?</label><select id="pagamento-contribuicao" required><option value="">Selecione...</option><option value="sim">Sim</option><option value="nao">Não</option></select></div>
                <div id="motivo-nao-pagamento-container" class="form-group hidden"><label for="motivo-nao-pagamento">Motivo do não pagamento:</label><textarea id="motivo-nao-pagamento" rows="3"></textarea></div>
                <div class="form-group"><label for="relato-encerramento">Breve relato (alta, desistência ou encaminhamento):</label><textarea id="relato-encerramento" rows="4" placeholder="Utilize esse campo para informar o que houve com o processo de plantão desse paciente..." required></textarea></div>
                <div class="form-group"><label>A disponibilidade de atendimento continua a mesma?</label><p id="disponibilidade-atual" style="font-weight: bold; color: var(--cor-primaria);"></p><select id="manter-disponibilidade" required><option value="">Selecione...</option><option value="sim">Sim</option><option value="nao">Não</option></select></div>
                <div id="nova-disponibilidade-container" class="hidden"></div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
            <button type="submit" id="modal-save-btn" class="action-button" form="encerramento-form">Salvar</button></div>
    </div>
</div>

<div id="horarios-pb-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Informar Horários - Psicoterapia Breve (PB)</h3><span class="close-button">&times;</span></div>
        <div class="modal-body">
            <form id="horarios-pb-form"><input type="hidden" id="paciente-id-horarios-modal"><input type="hidden" id="atendimento-id-horarios-modal">
                <div class="form-group"><label>Paciente iniciou o atendimento em PB?</label>
                    <div><input type="radio" id="iniciou-pb-sim" name="iniciou-pb" value="sim" required> <label for="iniciou-pb-sim">Sim</label><input type="radio" id="iniciou-pb-nao" name="iniciou-pb" value="nao" required> <label for="iniciou-pb-nao">Não</label><small style="display: block; margin-left: 25px; color: #666;">Selecione 'Não' apenas se o paciente desistiu ou não irá mais ser atendido por você.</small></div>
                </div>
                <div id="motivo-nao-inicio-pb-container" class="form-group hidden"><label>Qual o motivo do não início do atendimento?</label>
                    <div class="radio-group-vertical"><label><input type="radio" name="motivo-nao-inicio" value="desistiu"> Desistiu</label><label><input type="radio" name="motivo-nao-inicio" value="outra_modalidade"> Prefere outra modalidade de atendimento ou outro horário</label></div>
                </div>
                <div id="motivo-desistencia-container" class="form-group hidden"><label for="motivo-desistencia-pb">Descreva o motivo da desistência:</label><textarea id="motivo-desistencia-pb" rows="3" class="form-control"></textarea></div>
                <div id="detalhar-solicitacao-container" class="form-group hidden"><label for="detalhes-solicitacao-pb">Detalhe a solicitação do paciente (será enviada ao administrativo):</label><textarea id="detalhes-solicitacao-pb" rows="3" class="form-control"></textarea></div>
                <div id="form-continuacao-pb" class="hidden"></div>
            </form>
        </div>
        <div class="modal-footer"><button type="button" class="action-button secondary-button" data-close-modal>Cancelar</button><button type="submit" class="action-button" form="horarios-pb-form">Salvar</button></div>
    </div>
</div>

<div id="enviar-mensagem-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large">
        <div class="modal-header">
            <h2 class="modal-title-text">Enviar Mensagem</h2>
            </div>
        <div class="modal-body">
            <div id="mensagem-selecao-view">
                <p>Escolha um modelo de mensagem para enviar para <strong><span id="mensagem-paciente-nome-selecao"></span></strong>:</p>
                <div id="lista-modelos-mensagem" class="message-templates-list"></div>
            </div>
            <div id="mensagem-formulario-view" style="display: none;">
                <button id="btn-voltar-selecao" class="action-button secondary-button" style="margin-bottom: 20px;">&larr; Voltar para Modelos</button>
                <form id="mensagem-dynamic-form">
                    <h3 id="mensagem-form-title" style="color: var(--cor-primaria); margin-top: 0;"></h3>
                    <div id="mensagem-dynamic-form-container" class="dynamic-form-fields"></div>
                    <div class="output-area" style="margin-top: 20px;">
                        <label>Pré-visualização da Mensagem:</label>
                        <textarea readonly id="output-mensagem-preview"></textarea>
                    </div>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
            <button type="button" id="btn-gerar-enviar-whatsapp" class="action-button">Gerar e Enviar para WhatsApp</button>
        </div>
    </div>
</div>

<div id="desfecho-pb-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large">
        <div class="modal-header">
            <h3>Registrar Desfecho do Atendimento (PB)</h3>
            </div>
        <div id="desfecho-pb-modal-body" class="modal-body">
            </div>
        <div id="desfecho-pb-modal-footer" class="modal-footer" style="display: none;">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
             <button type="submit" id="btn-salvar-desfecho-submit" class="action-button" form="form-atendimento-pb">Salvar Desfecho</button>
        </div>
    </div>
</div>

<div id="alterar-horario-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large">
        <div class="modal-header">
            <h2 class="modal-title-text">Solicitar Alteração de Horário/Modalidade</h2>
        </div>
        <div class="modal-body">
            <form id="alterar-horario-form">
                <input type="hidden" id="alterar-paciente-id">
                <input type="hidden" id="alterar-atendimento-id">
                
                <fieldset>
                    <legend>Dados Atuais</legend>
                    <div class="form-row cols-2">
                         <div class="form-group">
                            <label>Nome do Paciente</label>
                            <input type="text" id="alterar-paciente-nome" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label>Profissional</label>
                            <input type="text" id="alterar-profissional-nome" class="form-control" readonly>
                        </div>
                    </div>
                     <div class="form-row cols-3">
                        <div class="form-group">
                            <label>Dia Atual</label>
                            <input type="text" id="alterar-dia-atual" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label>Horário Atual</label>
                            <input type="text" id="alterar-horario-atual" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label>Modalidade Atual</label>
                            <input type="text" id="alterar-modalidade-atual" class="form-control" readonly>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Nova Configuração da Sessão</legend>
                    <div class="form-row cols-3">
                        <div class="form-group">
                            <label for="alterar-dia-semana">Selecione o novo dia da sessão:</label>
                            <select id="alterar-dia-semana" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="segunda">Segunda-feira</option>
                                <option value="terca">Terça-feira</option>
                                <option value="quarta">Quarta-feira</option>
                                <option value="quinta">Quinta-feira</option>
                                <option value="sexta">Sexta-feira</option>
                                <option value="sabado">Sábado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="alterar-horario">Selecione o novo horário da sessão:</label>
                            <select id="alterar-horario" class="form-control" required>
                            </select>
                        </div>
                         <div class="form-group">
                            <label for="alterar-tipo-atendimento">Selecione o novo tipo de atendimento:</label>
                            <select id="alterar-tipo-atendimento" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="Online">Online</option>
                                <option value="Presencial">Presencial</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row cols-2">
                       <div class="form-group">
                            <label for="alterar-frequencia">O atendimento será realizado:</label>
                            <select id="alterar-frequencia" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="Semanal">Semanal</option>
                                <option value="Quinzenal">Quinzenal</option>
                                <option value="Mensal">Mensal</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="alterar-data-inicio">Informe a partir de qual data:</label>
                            <input type="date" id="alterar-data-inicio" class="form-control" required>
                        </div>
                    </div>
                     <div class="form-row cols-2">
                         <div class="form-group">
                            <label for="alterar-sala">Selecione abaixo a sala:</label>
                            <select id="alterar-sala" class="form-control" required>
                                <option value="Online">Online</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="alterar-grade">Alterar/Incluir na grade?</label>
                            <select id="alterar-grade" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="Sim">Sim</option>
                                <option value="Não">Não</option>
                            </select>
                        </div>
                    </div>
                </fieldset>
                <div class="form-group">
                    <label for="alterar-justificativa">Justificativa (Opcional):</label>
                    <textarea id="alterar-justificativa" rows="3" class="form-control" placeholder="Descreva brevemente o motivo da alteração, se necessário."></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
            <button type="button" class="action-button" id="btn-confirmar-alteracao-horario">Enviar Solicitação de Alteração</button>
        </div>
    </div>
</div>

<div id="reavaliacao-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large">
        <div class="modal-header">
            <h2 class="modal-title-text">Solicitar Reavaliação</h2>
        </div>
        <div class="modal-body">
            
            <fieldset class="info-fieldset">
                <legend>Passo a passo para agendar a Reavaliação</legend>
                <div class="reavaliacao-info-text">
                    <ol>
                        <li>
                            <strong>Critérios para reavaliação:</strong>
                            <ul>
                                <li>Estar há mais de 6 meses sendo atendido e não ter feito a reavaliação nesse período;</li>
                                <li>O Serviço Social deixou informado na ficha de triagem que deveria realizar uma reavaliação antes de 6 meses;</li>
                                <li>Identificou-se que o paciente tem condições de pagar um valor maior na contribuição;</li>
                                <li>Identificou-se que o paciente precisa reduzir o valor da contribuição.</li>
                            </ul>
                        </li>
                        <li><strong>Conversar com o paciente</strong> e orientar que uma das normas da EuPsico é a reavaliação, e que ele precisa passar novamente com o Serviço Social. Essa é uma das condições para ele continuar sendo atendido na EuPsico.</li>
                        <li><strong>Acessar a agenda de reavaliação</strong> junto com o paciente para agendar o melhor dia e horário.</li>
                        <li><strong>Preencher o formulário</strong> para notificar o administrativo (botão abaixo).</li>
                        <li>
                            <strong>Informar ao paciente</strong> que ele precisa encaminhar os seguintes documentos pelo WhatsApp da EuPsico:
                            <ul>
                                <li>Comprovante de endereço (dos últimos 3 meses);</li>
                                <li>Comprovante de renda (dos últimos 3 meses);</li>
                                <li>Caso não tenha carteira assinada ou renda, será necessário redigir uma carta de próprio punho com a declaração da renda familiar.</li>
                            </ul>
                        </li>
                        <li><strong>O administrativo entrará em contato para confirmar.</strong> (Para que isso aconteça, é fundamental preencher o formulário de notificação).</li>
                    </ol>
                </div>
            </fieldset>

            <div id="reavaliacao-form-container">
                
                <div id="reavaliacao-sem-agenda" class="info-note danger" style="display: none; text-align: center; padding: 15px; margin-top: 20px;">
                    Nenhuma agenda de reavaliação está configurada no momento. Por favor, entre em contato com o administrativo.
                </div>

                <form id="reavaliacao-form" style="display: none;">
                    <input type="hidden" id="reavaliacao-paciente-id">
                    
                    <fieldset>
                        <legend>Dados da Solicitação</legend>
                        <div class="form-row cols-2">
                            <div class="form-group">
                                <label>Nome do Profissional</label>
                                <input type="text" id="reavaliacao-profissional-nome" class="form-control" readonly>
                            </div>
                            <div class="form-group">
                                <label>Nome do Paciente</label>
                                <input type="text" id="reavaliacao-paciente-nome" class="form-control" readonly>
                            </div>
                        </div>
                         <div class="form-row cols-2">
                             <div class="form-group">
                                <label for="reavaliacao-valor-atual">Valor da Contribuição Atual (R$)</label>
                                <input type="number" id="reavaliacao-valor-atual" class="form-control" placeholder="Ex: 50.00">
                            </div>
                            <div class="form-group">
                                <label for="reavaliacao-motivo">Qual o motivo da reavaliação?</label>
                                <textarea id="reavaliacao-motivo" class="form-control" rows="3" required placeholder="Descreva o motivo..."></textarea>
                            </div>
                         </div>
                    </fieldset>

                    <fieldset>
                        <legend>Agendamento da Reavaliação</legend>
                        
                        <div id="reavaliacao-tipo-atendimento-group" class="form-group" style="display: none;">
                            <label for="reavaliacao-tipo-atendimento">Tipo de Atendimento</label>
                            <select id="reavaliacao-tipo-atendimento" class="form-control"></select>
                        </div>
                        
                        <div id="reavaliacao-agenda-container">
                            <div class="form-group">
                                <label>Escolha a data:</label>
                                <div id="reavaliacao-datas-disponiveis" class="slots-container date-slots">
                                    <p>Selecione uma modalidade para ver as datas.</p>
                                </div>
                                <input type="hidden" id="reavaliacao-data-selecionada">
                            </div>
                            <div class="form-group">
                                <label>Horários disponíveis:</label>
                                <div id="reavaliacao-horarios-disponiveis" class="slots-container">
                                    <p>Selecione uma data para ver os horários.</p>
                                </div>
                            </div>
                        </div>
                        </fieldset>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
            <button type="button" class="action-button" id="btn-confirmar-reavaliacao" style="display: none;">Enviar Solicitação</button>
        </div>
    </div>
</div>