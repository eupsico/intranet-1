<div class="container-fluid" id="detalhe-paciente-view">

    <div class="detalhe-paciente-header">
        <a href="#meus-pacientes" class="action-button secondary-button">&larr; Voltar para Meus Pacientes</a>
        
        <div class="action-buttons-container main-actions">
            <button id="btn-paciente-actions-toggle" class="action-button hamburger-toggle-button">
                <span>Gerenciar Atendimento</span> <div class="hamburger-icon"><div></div><div></div><div></div></div>
            </button>
            <div id="paciente-actions-menu" class="hamburger-menu-content">
                <button id="btn-abrir-modal-mensagem" class="hamburger-menu-item action-button">Enviar Mensagem</button>
                <button id="btn-abrir-modal-solicitar-sessoes" class="hamburger-menu-item action-button">Solicitar Novas Sess√µes</button>
                <button id="btn-abrir-modal-alterar-horario" class="hamburger-menu-item action-button">Alterar Hor√°rio</button>
                <button id="btn-abrir-modal-reavaliacao" class="hamburger-menu-item action-button secondary-button">Solicitar Reavalia√ß√£o</button>
                <button id="btn-abrir-modal-horarios-pb" class="hamburger-menu-item action-button special-button">Informar Hor√°rios PB</button>
                <button id="btn-abrir-modal-encaminhamento-pb" class="hamburger-menu-item action-button secondary-button">Solicitar Encaminhamento PB</button>
                <button id="btn-abrir-modal-desfecho-pb" class="hamburger-menu-item action-button danger-button">Registrar Desfecho PB</button>
                <button id="btn-abrir-modal-encerramento-plantao" class="hamburger-menu-item action-button danger-button">Registrar Encerramento Plant√£o</button>
            </div>
        </div>
    </div>
    
    <div class="detalhe-paciente-forms-column">
        
        <div class="accordion-container">
            
            <form id="form-info-pessoais">
        
                <fieldset class="accordion-item open">
                    <legend class="accordion-header">
                        <button type="button" class="accordion-button">
                            INFORMA√á√ïES PESSOAIS
                            <span class="accordion-icon">&#9660;</span> </button>
                    </legend>
                    <div class="accordion-content">
        
                        <div class="info-summary-grid cols-3">
                            <div class="form-group">
                                <label for="dp-nome-completo">Nome completo</label>
                                <input type="text" id="dp-nome-completo" class="form-control" readonly>
                            </div>
                            <div class="form-group readonly">
                                <label for="dp-status-atual-input">Status Atual:</label>
                                <input type="text" id="dp-status-atual-input" class="form-control status-badge-input" readonly>
                                <span id="dp-status-atual" class="readonly-value status-badge" style="display: none;">--</span>
                            </div>
                            <div class="form-group readonly">
                                <label for="dp-desde-input">Desde (Encaminhamento):</label>
                                <input type="text" id="dp-desde-input" class="form-control" readonly>
                                <span id="dp-desde" class="readonly-value" style="display: none;">--</span>
                            </div>
                        </div>
                        
                        <div class="form-group" id="dp-parceria-container" style="display: none; background-color: #e8f4fc; padding: 10px; border-radius: 5px; margin-bottom: 20px;">
                            <label for="dp-parceria" style="color: #0056b3; font-weight: bold;">Institui√ß√£o Parceira:</label>
                            <select id="dp-parceria" class="form-control">
                                <option value="">Selecione a parceria...</option>
                            </select>
                        </div>
        
                        <div class="form-grid cols-4">
                            <div class="form-group readonly">
                                <label for="dp-idade-input">Idade:</label>
                                <input type="text" id="dp-idade-input" class="form-control" readonly>
                                <span id="dp-idade" class="readonly-value" style="display: none;">--</span>
                            </div>
                            <div class="form-group">
                                <label for="dp-telefone">Telefone</label>
                                <input type="text" id="dp-telefone" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="dp-data-nascimento">Data de Nascimento</label>
                                <input type="date" id="dp-data-nascimento" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="dp-cpf">CPF</label>
                                <input type="text" id="dp-cpf" class="form-control" readonly>
                            </div>
                        </div>
        
                        <div class="sub-legend">Contatos</div>
                        <div class="form-grid cols-1">
                            <div class="form-group">
                                <label for="dp-responsavel-nome">Nome do Respons√°vel (se aplic√°vel)</label>
                                <input type="text" id="dp-responsavel-nome" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="dp-contato-emergencia-nome">Contato de Emerg√™ncia (Nome)</label>
                                <input type="text" id="dp-contato-emergencia-nome" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="dp-contato-emergencia-telefone">Contato de Emerg√™ncia (Telefone)</label>
                                <input type="text" id="dp-contato-emergencia-telefone" class="form-control">
                            </div>
                        </div>
                                                <div class="form-group" style="background-color: #f9f9f9; padding: 15px; border-radius: 5px; border: 1px solid #eee; margin-bottom: 20px;">
                            <label style="color: var(--cor-primaria); font-weight: bold;">üìÑ Contrato Terap√™utico Assinado</label>
                            
                            <div id="dp-contrato-link-container" style="margin-bottom: 10px; display: none;">
                                <a href="#" id="dp-contrato-link" target="_blank" class="action-button secondary-button small" style="text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
                                    <span>üëÅÔ∏è Visualizar Contrato Atual</span>
                                </a>
                                <small class="text-muted" style="display: block; margin-top: 5px;">Enviado em: <span id="dp-contrato-data"></span></small>
                            </div>

                            <div class="file-upload-wrapper">
                                <label for="dp-contrato-upload" style="font-size: 0.9em; cursor: pointer;">Enviar/Atualizar Contrato (PDF ou Imagem):</label>
                                <input type="file" id="dp-contrato-upload" class="form-control" accept="application/pdf, image/*">
                            </div>
                        </div>
        
                        <div class="button-bar" style="margin-top: 20px;">
                            <button type="submit" class="action-button" id="btn-salvar-info-pessoais">Salvar Altera√ß√µes Pessoais</button>
                        </div>
        
                    </div> 
                </fieldset> 
        
                <fieldset class="accordion-item"> 
                    <legend class="accordion-header">
                        <button type="button" class="accordion-button">
                            ENDERE√áO
                            <span class="accordion-icon">&#9654;</span> </button>
                    </legend>
                    <div class="accordion-content">
        
                        <div class="form-grid cols-2">
                            <div class="form-group grid-col-span-2">
                                <label for="dp-endereco-logradouro">Logradouro:</label>
                                <input type="text" id="dp-endereco-logradouro" class="form-control" placeholder="Rua, Av...">
                            </div>
                            <div class="form-group">
                                <label for="dp-endereco-numero">N√∫mero:</label>
                                <input type="text" id="dp-endereco-numero" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="dp-endereco-complemento">Complemento:</label>
                                <input type="text" id="dp-endereco-complemento" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="dp-endereco-bairro">Bairro:</label>
                                <input type="text" id="dp-endereco-bairro" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="dp-endereco-cidade">Cidade:</label>
                                <input type="text" id="dp-endereco-cidade" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="dp-endereco-estado">Estado:</label>
                                <input type="text" id="dp-endereco-estado" class="form-control" maxlength="2">
                            </div>
                            <div class="form-group">
                                <label for="dp-endereco-cep">CEP:</label>
                                <input type="text" id="dp-endereco-cep" class="form-control" placeholder="00000-000">
                            </div>
                            <div class="button-bar" style="margin-top: 20px;">
                                <button type="button" class="action-button" id="btn-salvar-endereco">Salvar Endere√ßo</button> 
                            </div>
                        </div>
                    </div> 
                </fieldset> 
            </form>
            <form id="form-info-financeiras">
                <fieldset class="accordion-item"> 
                    <legend class="accordion-header">
                        <button type="button" class="accordion-button">
                            INFORMA√á√ïES FINANCEIRAS
                            <span class="accordion-icon">&#9654;</span> </button>
                    </legend>
                    <div class="accordion-content">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="dp-valor-contribuicao">Valor da Contribui√ß√£o Mensal (R$)</label>
                                <input type="text" id="dp-valor-contribuicao" class="form-control" placeholder="Ex: 50,00">
                            </div>
                            <div class="button-bar" style="margin-top: 20px;">
                                <button type="submit" class="action-button" id="btn-salvar-info-financeiras">Salvar Contribui√ß√£o</button>
                            </div>
                        </div>
                    </div> 
                </fieldset>
            </form>
            
           <form id="acompanhamento-clinico-form">
                <fieldset class="accordion-item"> 
                    <legend class="accordion-header">
                        <button type="button" class="accordion-button">
                            ACOMPANHAMENTO CL√çNICO
                            <span class="accordion-icon">&#9654;</span> </button>
                    </legend>
                    <div class="accordion-content">
                        <fieldset>
                            <legend>Acompanhamento Cl√≠nico</legend>
                            <div class="form-group">
                                <label for="ac-avaliacao-demanda">AVALIA√á√ÉO DA DEMANDA (QUEIXA DO PACIENTE)</label>
                                <p class="field-description">(Explica√ß√£o: Descreva a queixa principal trazida pelo paciente no in√≠cio do tratamento.)</p>
                                <textarea id="ac-avaliacao-demanda" rows="6" class="form-control"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="ac-definicao-objetivos">DEFINI√á√ÉO DE OBJETIVOS DO TRATAMENTO (PLANOS DE TRATAMENTO)</label>
                                <p class="field-description">(Explica√ß√£o: Liste os objetivos acordados com o paciente para o processo terap√™utico.)</p>
                                <textarea id="ac-definicao-objetivos" rows="6" class="form-control"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="ac-diagnostico">DIAGN√ìSTICO</label>
                                <p class="field-description">(Explica√ß√£o: Informe o diagn√≥stico (se houver), conforme CID ou DSM.)</p>
                                <textarea id="ac-diagnostico" rows="6" class="form-control"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="ac-registro-encerramento">REGISTRO DE ENCERRAMENTO</label>
                                <p class="field-description">(Explica√ß√£o: Deve ser utilizado em caso de alta, desist√™ncia ou encaminhamento, descrevendo o motivo e o desfecho do processo.)</p>
                                <textarea id="ac-registro-encerramento" rows="6" class="form-control"></textarea>
                            </div>

                            <div class="button-bar">
                                <button type="submit" class="action-button" id="btn-salvar-acompanhamento">Salvar Acompanhamento Cl√≠nico</button>
                            </div>
                        </fieldset>
                    </div> 
                </fieldset>
            </form>
            <form id="documentos-section-container">
                <fieldset class="accordion-item">
                    <legend class="accordion-header">
                        <button type="button" class="accordion-button">
                            DOCUMENTOS E ANEXOS
                            <span class="accordion-icon">&#9654;</span> 
                        </button>
                    </legend>
                    <div class="accordion-content">
                        
                        <div class="form-group" style="background-color: #fff; padding: 15px; border-radius: 5px; border: 1px solid #ddd; margin-bottom: 25px;">
                            <h4 style="color: var(--cor-primaria); margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px;">üìÑ Contrato Terap√™utico</h4>
                            
                            <div id="dp-contrato-status-assinado" style="display: none; margin-top: 15px;">
                                <p style="color: var(--cor-sucesso); font-weight: bold; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-check-circle"></i> Contrato Assinado
                                </p>
                                <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
                                    Assinado em: <span id="dp-contrato-data-texto"></span>
                                </p>
                                <a href="#" id="dp-contrato-link-visualizar" target="_blank" class="action-button" style="text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
                                    <span>üëÅÔ∏è Visualizar PDF</span>
                                </a>
                            </div>

                            <div id="dp-contrato-status-pendente" style="display: none; margin-top: 15px;">
                                <div class="alert alert-warning" style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <span><strong>Pendente:</strong> O contrato terap√™utico ainda n√£o foi assinado.</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group" style="background-color: #f9f9f9; padding: 15px; border-radius: 5px; border: 1px solid #eee;">
                            <h4 style="color: var(--cor-primaria); margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px;">üìÅ Arquivos e Anexos (Anamnese, Testes, etc.)</h4>
                            
                            <div id="ac-arquivos-lista" style="margin-bottom: 20px;">
                                <p class="text-muted" style="font-size: 0.9em; font-style: italic;">Carregando arquivos...</p>
                            </div>

                            <label for="ac-novo-arquivo" style="font-size: 0.9em; cursor: pointer; font-weight: 600;">Adicionar Novo Arquivo:</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="file" id="ac-novo-arquivo" class="form-control" style="flex-grow: 1;">
                                <span id="upload-status" style="font-size: 0.85em; font-style: italic; color: var(--cor-primaria);"></span>
                            </div>
                            <small class="text-muted">Selecione um arquivo (PDF, Imagem) para salvar automaticamente no prontu√°rio.</small>
                        </div>

                    </div>
                </fieldset>
            </form>
        </div> 
        <div id="pendencias-section">
            <fieldset>
                <legend>PEND√äNCIAS <span id="pendencias-count-badge" class="badge" style="display: none;">0</span></legend>
                <div id="pendencias-loading" style="display: none;"><div class="loading-spinner"></div> Verificando pend√™ncias...</div>
                <ul id="pendencias-list" class="pendencias-list-items">
                </ul>
                <div id="pendencias-placeholder" style="display: none; text-align: center; padding: 15px;">Nenhuma pend√™ncia encontrada.</div>
            </fieldset>
        </div>
        
    </div> <div class="detalhe-paciente-tabs-column">
        <div class="tabs-container vertical-tabs"> 
            <button class="tab-link active" data-tab="tab-sessoes">Sess√µes</button>
            <button class="tab-link" data-tab="tab-prontuario">Prontu√°rio Psicol√≥gico</button>
        </div>

        <div class="tabs-content-container">
            <div id="tab-sessoes" class="tab-content active">
                <div class="session-list" id="session-list-container">
                    <div class="session-list-placeholder" id="session-list-placeholder" style="display: none;">
                        <p>Nenhuma sess√£o encontrada para este paciente.</p>
                    </div>
                    <div class="loading-spinner" id="session-list-loading"></div>
                </div>
            </div>

            <div id="tab-prontuario" class="tab-content">
                <div class="prontuario-generator-layout">
                    <form id="form-gerar-prontuario">
                        <fieldset>
                            <legend>Gerar Prontu√°rio em PDF</legend>
                            <p>Selecione as informa√ß√µes que devem constar no prontu√°rio:</p>
                            <div class="checkbox-grid">
                                <label class="form-check"><input type="checkbox" class="form-check-input" name="prontuario-item" value="info_pessoais" checked> Informa√ß√µes Pessoais</label>
                                <label class="form-check"><input type="checkbox" class="form-check-input" name="prontuario-item" value="info_financeiras" checked> Informa√ß√µes Financeiras</label>
                                <label class="form-check"><input type="checkbox" class="form-check-input" name="prontuario-item" value="ac_demanda" checked> Avalia√ß√£o da Demanda</label>
                                <label class="form-check"><input type="checkbox" class="form-check-input" name="prontuario-item" value="ac_objetivos" checked> Objetivos do Tratamento</label>
                                <label class="form-check"><input type="checkbox" class="form-check-input" name="prontuario-item" value="ac_diagnostico" checked> Diagn√≥stico</label>
                                <label class="form-check"><input type="checkbox" class="form-check-input" name="prontuario-item" value="ac_encerramento" checked> Registro de Encerramento</label>
                                <label class="form-check"><input type="checkbox" class="form-check-input" name="prontuario-item" value="sessoes_lista" checked> Lista de Sess√µes (Datas e Status)</label>
                                <label class="form-check"><input type="checkbox" class="form-check-input" name="prontuario-item" value="sessoes_evolucao" checked> Ficha Evolu√ß√£o (de todas as sess√µes)</label>
                                <label class="form-check"><input type="checkbox" class="form-check-input" name="prontuario-item" value="sessoes_compartilhado_prof" checked> Campo Compartilhado (Profissionais)</label>
                                <label class="form-check"><input type="checkbox" class="form-check-input" name="prontuario-item" value="sessoes_compartilhado_admin" checked> Campo Compartilhado (Admin)</label>
                            </div>
                        </fieldset>
                    </form>
                    <div class="prontuario-generator-actions">
                        <p>O documento ser√° gerado em formato PDF e incluir√° os dados do profissional e do paciente.</p>
                        <button type="button" class="action-button" id="btn-gerar-prontuario-pdf">Gerar PDF</button>
                    </div>
                </div>
            </div>
        </div> 
    </div> </div>
<div id="anotacoes-sessao-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large flex-layout"> 
        <form id="anotacoes-sessao-form">
            <div class="modal-header">
                <h2 class="modal-title-text">Anota√ß√µes da Sess√£o</h2>
                <span class="close-button modal-cancel-btn">&times;</span>
            </div> frequencia frequencia frequencia
            <div class="modal-body"> 
                <input type="hidden" id="anotacoes-sessao-id">

                <div class="tabs-container horizontal-tabs" id="anotacoes-tabs-nav">
                    <button type="button" class="tab-link active" data-tab="anotacao-tab-evolucao">Ficha Evolu√ß√£o</button>
                    <button type="button" class="tab-link" data-tab="anotacao-tab-prof">Comp. Profissionais</button>
                    <button type="button" class="tab-link" data-tab="anotacao-tab-admin">Comp. Admin</button>
                </div>

                <div class="tabs-content-container" id="anotacoes-tabs-content">
                    
                    <div id="anotacao-tab-evolucao" class="tab-content active">
                        <div class="form-group">
                            <label for="anotacoes-ficha-evolucao">Ficha Evolu√ß√£o</label>
                            <p class="field-description">
                                Este √© o campo referente ao item do prontu√°rio chamado Registro de evolu√ß√£o do quadro. Faz parte das diretrizes exigidas pelo CFP na Resolu√ß√£o 001/2009. √â importante que os pontos principais da an√°lise sejam inseridos de forma sucinta e resumida, mantendo a evolu√ß√£o registrada.
                            </p>
                            <textarea id="anotacoes-ficha-evolucao" rows="5" class="form-control"></textarea>
                        </div>
                    </div>

                    <div id="anotacao-tab-prof" class="tab-content">
                        <div class="form-group">
                            <label for="anotacoes-campo-compartilhado-prof">Campo Compartilhado (entre profissionais)</label>
                            <p class="field-description">
                                <strong>Aten√ß√£o:</strong> Essas anota√ß√µes s√£o acess√≠veis e edit√°veis por todos os profissionais envolvidos no atendimento ao cliente, bem como pelo administrador. √â importante observar que <strong>informa√ß√µes confidenciais n√£o devem ser inclu√≠das</strong> neste campo.
                            </p>
                            <textarea id="anotacoes-campo-compartilhado-prof" rows="5" class="form-control"></textarea>
                        </div>
                    </div>

                    <div id="anotacao-tab-admin" class="tab-content">
                        <div class="form-group">
                            <label for="anotacoes-campo-compartilhado-admin">Campo Compartilhado (com administrador)</label>
                            <p class="field-description">
                                Todas as anota√ß√µes feitas nesse campo s√£o compartilhadas com o administrador da sua cl√≠nica para serem visualizadas e est√£o de acordo com as diretrizes exigidas pelo CFP na Resolu√ß√£o 001/2009.
                            </p>
                            <textarea id="anotacoes-campo-compartilhado-admin" rows="5" class="form-control"></textarea>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
                <button type="submit" class="action-button" id="btn-salvar-anotacoes">Salvar Anota√ß√µes</button>
            </div>
        </form>
    </div>
</div>

<div id="solicitar-sessoes-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large">
        <div class="modal-header"> <h2 class="modal-title-text">Solicitar Novas Sess√µes</h2>
            <span class="close-button modal-cancel-btn">&times;</span>
        </div>
        <div class="modal-body">
            <form id="solicitar-sessoes-form">
                <input type="hidden" id="solicitar-paciente-id">
                <input type="hidden" id="solicitar-atendimento-id">

                <fieldset>
                    <legend>Dados do Agendamento</legend>
                    <div class="form-grid cols-2"> <div class="form-group">
                            <label>Nome do Profissional</label>
                            <input type="text" id="solicitar-profissional-nome" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label>Nome do Paciente</label>
                            <input type="text" id="solicitar-paciente-nome" class="form-control" readonly>
                        </div>
                    </div>
                </fieldset>

<fieldset>
                    <legend>Detalhes da Nova Sess√£o</legend>
                    <div class="form-grid cols-4"> <div class="form-group">
                            <label for="solicitar-dia-semana">Dia da Sess√£o</label>
                            <select id="solicitar-dia-semana" class="form-control" required>
                                <option value="">Selecione...</option> <option value="Segunda-feira">Segunda-feira</option>
                                <option value="Ter√ßa-feira">Ter√ßa-feira</option>
                                <option value="Quarta-feira">Quarta-feira</option>
                                <option value="Quinta-feira">Quinta-feira</option>
                                <option value="Sexta-feira">Sexta-feira</option>
                                <option value="S√°bado">S√°bado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="solicitar-horario">Hor√°rio</label>
                            <select id="solicitar-horario" class="form-control" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="solicitar-tipo-atendimento">Tipo de Atendimento</label>
                            <select id="solicitar-tipo-atendimento" class="form-control" required>
                                <option value="">Selecione...</option> <option value="online">Online</option>
                                <option value="presencial">Presencial</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="solicitar-frequencia">Frequ√™ncia</label>
                            <select id="solicitar-frequencia" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="Semanal">Semanal</option>
                                <option value="Quinzenal">Quinzenal</option>
                                <option value="Mensal">Mensal</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid cols-2"> <div class="form-group">
                            <label for="solicitar-data-inicio">Iniciar sess√µes a partir de:</label>
                            <input type="date" id="solicitar-data-inicio" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="solicitar-sala">Sala de Atendimento</label>
                            <select id="solicitar-sala" class="form-control" required>
                                <option value="Online">Online</option>
                                </select>
                        </div>
                    </div>
                </fieldset>
                <div id="validacao-grade-feedback" class="info-note" style="display: none;"></div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
            <button type="button" class="action-button" id="btn-confirmar-solicitacao">Enviar Solicita√ß√£o</button>
        </div>
    </div>
</div>

<div id="encerramento-modal" class="modal-overlay" style="display: none;"> <div class="modal-content">
        <div class="modal-header">
            <h3 id="encerramento-modal-title">Encerrar Plant√£o</h3>
            <span class="close-button modal-cancel-btn">&times;</span>
        </div> 
        <div class="modal-body">
            <form id="encerramento-form">
                <input type="hidden" id="paciente-id-modal">
                <div class="form-group">
                    <label>Encaminhamento:</label>
                    <div id="encerramento-encaminhamento" class="checkbox-grid"> <label><input type="checkbox" name="encaminhamento" value="Alta"> Alta</label>
                        <label><input type="checkbox" name="encaminhamento" value="Desist√™ncia"> Desist√™ncia</label>
                        <label><input type="checkbox" name="encaminhamento" value="Atendimento Psicol√≥gico"> Atendimento Psicol√≥gico</label>
                        <label><input type="checkbox" name="encaminhamento" value="Atendimento Psicopedag√≥gico"> Atendimento Psicopedag√≥gico</label>
                        <label><input type="checkbox" name="encaminhamento" value="Atendimento com musicoterapeuta"> Atendimento com musicoterapeuta</label>
                        <label><input type="checkbox" name="encaminhamento" value="RAPS"> RAPS</label>
                        <label><input type="checkbox" name="encaminhamento" value="Grupo Quest√µes de peso"> Grupo Quest√µes de peso</label>
                        <label class="disabled"><input type="checkbox" name="encaminhamento" value="Grupo papo de adolescente" disabled> Grupo papo de adolescente (Inativo)</label>
                        <label class="disabled"><input type="checkbox" name="encaminhamento" value="Grupo de apoio √† fam√≠lia" disabled> Grupo de apoio √† fam√≠lia (Inativo)</label>
                        <label><input type="checkbox" name="encaminhamento" value="Grupo Funcional"> Grupo Funcional</label>
                        <label><input type="checkbox" name="encaminhamento" value="Grupo Envelhecimento Ativo"> Grupo Envelhecimento Ativo</label>
                        <label class="disabled"><input type="checkbox" name="encaminhamento" value="Grupo TransViv√™ncias" disabled> Grupo TransViv√™ncias (Inativo)</label>
                        <label><input type="checkbox" name="encaminhamento" value="Grupo Reexista"> Grupo Reexista</label>
                    </div>
                </div>
                <div class="form-group"><label for="data-encerramento">Data de encerramento/alta/desist√™ncia:</label><input type="date" id="data-encerramento" required class="form-control"></div>
                <div class="form-group"><label for="quantidade-sessoes">Quantidade de sess√µes do plant√£o:</label><input type="number" id="quantidade-sessoes" required class="form-control"></div>
                <div class="form-group"><label for="pagamento-contribuicao">O paciente efetuou o pagamento da contribui√ß√£o?</label><select id="pagamento-contribuicao" required class="form-control"><option value="">Selecione...</option><option value="sim">Sim</option><option value="nao">N√£o</option></select></div>
                <div id="motivo-nao-pagamento-container" class="form-group hidden"><label for="motivo-nao-pagamento">Motivo do n√£o pagamento:</label><textarea id="motivo-nao-pagamento" rows="3" class="form-control"></textarea></div>
                <div class="form-group"><label for="relato-encerramento">Breve relato (alta, desist√™ncia ou encaminhamento):</label><textarea id="relato-encerramento" rows="4" placeholder="Utilize esse campo para informar o que houve com o processo de plant√£o desse paciente..." required class="form-control"></textarea></div>
                <div class="form-group"><label>A disponibilidade de atendimento continua a mesma?</label><p id="disponibilidade-atual" style="font-weight: bold; color: var(--cor-primaria);"></p><select id="manter-disponibilidade" required class="form-control"><option value="">Selecione...</option><option value="sim">Sim</option><option value="nao">N√£o</option></select></div>
                <div id="nova-disponibilidade-container" class="hidden"></div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
            <button type="submit" id="modal-save-btn" class="action-button" form="encerramento-form">Salvar</button>
        </div>
    </div>
</div>

<div id="horarios-pb-modal" class="modal-overlay" style="display: none;"> <div class="modal-content">
        <div class="modal-header">
            <h3>Informar Hor√°rios - Psicoterapia Breve (PB)</h3><span class="close-button modal-cancel-btn">&times;</span>
        </div>
        <div class="modal-body">
            <form id="horarios-pb-form"><input type="hidden" id="paciente-id-horarios-modal"><input type="hidden" id="atendimento-id-horarios-modal">
        <div class="form-group">
        <label>Paciente iniciou o atendimento em PB?</label>
        <div style="display: flex; gap: 20px; align-items: center; margin-top: 8px;">
            <div>
            <input type="radio" id="iniciou-pb-sim" name="iniciou-pb" value="sim" required>
            <label for="iniciou-pb-sim">Sim</label>
            </div>
            <div>
            <input type="radio" id="iniciou-pb-nao" name="iniciou-pb" value="nao" required>
            <label for="iniciou-pb-nao">N√£o</label>
            </div>
        </div>
        <small style="display: block; margin-top: 5px; color: #666;">
            Selecione 'N√£o' apenas se o paciente desistiu ou n√£o ir√° mais ser atendido por voc√™.
        </small>
        </div>
                <div id="motivo-nao-inicio-pb-container" class="form-group hidden"><label>Qual o motivo do n√£o in√≠cio do atendimento?</label>
                    <div class="radio-group-vertical"><label><input type="radio" name="motivo-nao-inicio" value="desistiu"> Desistiu</label><label><input type="radio" name="motivo-nao-inicio" value="outra_modalidade"> Prefere outra modalidade de atendimento ou outro hor√°rio</label></div>
                </div>
                <div id="motivo-desistencia-container" class="form-group hidden"><label for="motivo-desistencia-pb">Descreva o motivo da desist√™ncia:</label><textarea id="motivo-desistencia-pb" rows="3" class="form-control"></textarea></div>
               <div id="form-alteracao-pb" class="hidden"></div>
                
                <div id="form-continuacao-pb" class="hidden"></div>
            </form>
        </div>
        <div class="modal-footer"><button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button><button type="submit" class="action-button" form="horarios-pb-form">Salvar</button></div>
    </div>
</div>

<div id="enviar-mensagem-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large">
        <div class="modal-header">
            <h2 class="modal-title-text">Enviar Mensagem</h2>
             <span class="close-button modal-cancel-btn">&times;</span> </div>
        <div class="modal-body">
            <div id="mensagem-selecao-view">
                <p>Escolha um modelo de mensagem para enviar para <strong><span id="mensagem-paciente-nome-selecao"></span></strong>:</p>
                <div id="lista-modelos-mensagem" class="message-templates-list"></div>
            </div>
            <div id="mensagem-formulario-view" style="display: none;">
                <button type="button" id="btn-voltar-selecao" class="action-button secondary-button" style="margin-bottom: 20px;">&larr; Voltar para Modelos</button>
                <form id="mensagem-dynamic-form">
                    <h3 id="mensagem-form-title" style="color: var(--cor-primaria); margin-top: 0;"></h3>
                    <div id="mensagem-dynamic-form-container" class="dynamic-form-fields"></div>
                    <div class="output-area" style="margin-top: 20px;">
                        <label>Pr√©-visualiza√ß√£o da Mensagem:</label>
                        <textarea readonly id="output-mensagem-preview" rows="5"></textarea> </div>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
            <button type="button" id="btn-gerar-enviar-whatsapp" class="action-button">Gerar e Enviar para WhatsApp</button>
        </div>
    </div>
</div>

<div id="desfecho-pb-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large">
        <div class="modal-header">
            <h3>Registrar Desfecho do Atendimento (PB)</h3>
            <span class="close-button modal-cancel-btn">&times;</span> </div>
        <div id="desfecho-pb-modal-body" class="modal-body">
            </div>
        <div id="desfecho-pb-modal-footer" class="modal-footer" style="display: none;">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
            <button type="submit" id="btn-salvar-desfecho-submit" class="action-button" form="form-atendimento-pb">Salvar Desfecho</button>
        </div>
    </div>
</div>

<div id="encaminhamento-pb-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large">
        <div class="modal-header">
            <h3>Solicitar Encaminhamento (PB)</h3>
            <span class="close-button modal-cancel-btn">&times;</span>
        </div>
        <div id="encaminhamento-pb-modal-body" class="modal-body">
            </div>
        <div id="encaminhamento-pb-modal-footer" class="modal-footer" style="display: none;">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
            <button type="submit" id="btn-salvar-encaminhamento-submit" class="action-button" form="form-encaminhamento-pb">Enviar Solicita√ß√£o</button>
        </div>
    </div>
</div>
<div id="alterar-horario-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large">
        <div class="modal-header">
            <h2 class="modal-title-text">Solicitar Altera√ß√£o de Hor√°rio/Modalidade</h2>
             <span class="close-button modal-cancel-btn">&times;</span> </div>
        <div class="modal-body">
            <form id="alterar-horario-form">
                <input type="hidden" id="alterar-paciente-id">
                <input type="hidden" id="alterar-atendimento-id">

                <fieldset>
                    <legend>Dados Atuais</legend>
                    <div class="form-grid cols-2"> <div class="form-group">
                            <label>Nome do Paciente</label>
                            <input type="text" id="alterar-paciente-nome" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label>Profissional</label>
                            <input type="text" id="alterar-profissional-nome" class="form-control" readonly>
                        </div>
                    </div>
                    <div class="form-grid cols-3"> <div class="form-group">
                            <label>Dia Atual</label>
                            <input type="text" id="alterar-dia-atual" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label>Hor√°rio Atual</label>
                            <input type="text" id="alterar-horario-atual" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label>Modalidade Atual</label>
                            <input type="text" id="alterar-modalidade-atual" class="form-control" readonly>
                        </div>
                    </div>
                </fieldset>

<fieldset>
                    <legend>Nova Configura√ß√£o da Sess√£o</legend>
                    <div class="form-grid cols-4"> <div class="form-group">
                            <label for="alterar-dia-semana">Selecione o novo dia da sess√£o:*</label>
                            <select id="alterar-dia-semana" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="Segunda-feira">Segunda-feira</option>
                                <option value="Ter√ßa-feira">Ter√ßa-feira</option>
                                <option value="Quarta-feira">Quarta-feira</option>
                                <option value="Quinta-feira">Quinta-feira</option>
                                <option value="Sexta-feira">Sexta-feira</option>
                                <option value="S√°bado">S√°bado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="alterar-horario">Selecione o novo hor√°rio da sess√£o:*</label>
                            <select id="alterar-horario" class="form-control" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="alterar-tipo-atendimento">Selecione o novo tipo de atendimento:*</label>
                            <select id="alterar-tipo-atendimento" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="Online">Online</option>
                                <option value="Presencial">Presencial</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="alterar-frequencia">O atendimento ser√° realizado:*</label>
                            <select id="alterar-frequencia" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="Semanal">Semanal</option>
                                <option value="Quinzenal">Quinzenal</option>
                                <option value="Mensal">Mensal</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid cols-1"> 
                        <div class="form-group">
                            <label for="alterar-data-inicio">Informe a partir de qual data:*</label>
                            <input type="date" id="alterar-data-inicio" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-grid cols-2"> <div class="form-group">
                            <label for="alterar-sala">Selecione abaixo a sala:*</label>
                            <select id="alterar-sala" class="form-control" required>
                                <option value="Online">Online</option>
                                </select>
                        </div>
                        <div class="form-group">
                            <label for="alterar-grade">Alterar/Incluir na grade?</label>
                            <select id="alterar-grade" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="Sim">Sim</option>
                                <option value="N√£o">N√£o</option>
                            </select>
                        </div>
                    </div>
                </fieldset>
                <div class="form-group">
                    <label for="alterar-justificativa">Justificativa (Opcional):</label>
                    <textarea id="alterar-justificativa" rows="3" class="form-control" placeholder="Descreva brevemente o motivo da altera√ß√£o, se necess√°rio."></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
            <button type="button" class="action-button" id="btn-confirmar-alteracao-horario">Enviar Solicita√ß√£o de Altera√ß√£o</button>
        </div>
    </div>
</div>

<div id="reavaliacao-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large">
        <div class="modal-header">
            <h2 class="modal-title-text">Solicitar Reavalia√ß√£o</h2>
             <span class="close-button modal-cancel-btn">&times;</span> </div>
        <div class="modal-body">

            <fieldset class="info-fieldset"> <legend>Passo a passo para agendar a Reavalia√ß√£o</legend>
                <div class="reavaliacao-info-text">
                    <ol>
                        <li>
                            <strong>Crit√©rios para reavalia√ß√£o:</strong>
                            <ul>
                                <li>Estar h√° mais de 6 meses sendo atendido e n√£o ter feito a reavalia√ß√£o nesse per√≠odo;</li>
                                <li>O Servi√ßo Social deixou informado na ficha de triagem que deveria realizar uma reavalia√ß√£o antes de 6 meses;</li>
                                <li>Identificou-se que o paciente tem condi√ß√µes de pagar um valor maior na contribui√ß√£o;</li>
                                <li>Identificou-se que o paciente precisa reduzir o valor da contribui√ß√£o.</li>
                            </ul>
                        </li>
                        <li><strong>Conversar com o paciente</strong> e orientar que uma das normas da EuPsico √© a reavalia√ß√£o, e que ele precisa passar novamente com o Servi√ßo Social. Essa √© uma das condi√ß√µes para ele continuar sendo atendido na EuPsico.</li>
                        <li><strong>Acessar a agenda de reavalia√ß√£o</strong> junto com o paciente para agendar o melhor dia e hor√°rio.</li>
                        <li><strong>Preencher o formul√°rio</strong> para notificar o administrativo (bot√£o abaixo).</li>
                        <li>
                            <strong>Informar ao paciente</strong> que ele precisa encaminhar os seguintes documentos pelo WhatsApp da EuPsico:
                             <ul>
                                <li>Comprovante de endere√ßo (dos √∫ltimos 3 meses);</li>
                                <li>Comprovante de renda (dos √∫ltimos 3 meses);</li>
                                <li>Caso n√£o tenha carteira assinada ou renda, ser√° necess√°rio redigir uma carta de pr√≥prio punho com a declara√ß√£o da renda familiar.</li>
                            </ul>
                        </li>
                        <li><strong>O administrativo entrar√° em contato para confirmar.</strong> (Para que isso aconte√ßa, √© fundamental preencher o formul√°rio de notifica√ß√£o).</li>
                    </ol>
                </div>
            </fieldset>

            <div id="reavaliacao-form-container">

                <div id="reavaliacao-sem-agenda" class="alert alert-warning" style="display: none; text-align: center;"> Nenhuma agenda de reavalia√ß√£o est√° configurada no momento. Por favor, entre em contato com o administrativo.
                </div>

                <form id="reavaliacao-form" style="display: none;">
                    <input type="hidden" id="reavaliacao-paciente-id">
                    <input type="hidden" id="reavaliacao-atendimento-id"> <fieldset>
                        <legend>Dados da Solicita√ß√£o</legend>
                        <div class="form-grid cols-2"> <div class="form-group">
                                <label>Nome do Profissional</label>
                                <input type="text" id="reavaliacao-profissional-nome" class="form-control" readonly>
                            </div>
                            <div class="form-group">
                                <label>Nome do Paciente</label>
                                <input type="text" id="reavaliacao-paciente-nome" class="form-control" readonly>
                            </div>
                        </div>
                        <div class="form-grid cols-2"> <div class="form-group">
                                <label for="reavaliacao-valor-atual">Valor da Contribui√ß√£o Atual (R$)</label>
                                <input type="text" id="reavaliacao-valor-atual" class="form-control" placeholder="Ex: 50,00">
                            </div>
                            <div class="form-group">
                                <label for="reavaliacao-motivo">Qual o motivo da reavalia√ß√£o?</label>
                                <textarea id="reavaliacao-motivo" class="form-control" rows="3" required placeholder="Descreva o motivo..."></textarea>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Agendamento da Reavalia√ß√£o</legend>

                        <div id="reavaliacao-tipo-atendimento-group" class="form-group" style="display: none;">
                            <label for="reavaliacao-tipo-atendimento">Tipo de Atendimento</label>
                            <select id="reavaliacao-tipo-atendimento" class="form-control"></select>
                        </div>

                        <div id="reavaliacao-agenda-container">
                             <div class="form-group">
                                <label>Escolha a data:</label>
                                <div id="reavaliacao-datas-disponiveis" class="slots-container date-slots"> <p>Selecione uma modalidade para ver as datas.</p>
                                </div>
                                <input type="hidden" id="reavaliacao-data-selecionada">
                            </div>
                            <div class="form-group">
                                <label>Hor√°rios dispon√≠veis:</label>
                                <div id="reavaliacao-horarios-disponiveis" class="slots-container"> <p>Selecione uma data para ver os hor√°rios.</p>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="action-button secondary-button modal-cancel-btn">Cancelar</button>
            <button type="button" class="action-button" id="btn-confirmar-reavaliacao" style="display: none;">Enviar Solicita√ß√£o</button>
        </div>
    </div>
</div>